@using Microsoft.AspNetCore.Http;
@model IEnumerable<Serwis.Models.Domains.OrderPosition>
@inject IHttpContextAccessor HttpContextAccessor;

@{
    var sessionId = HttpContextAccessor.HttpContext?.Session.GetString("Id");



}
<div class="bookItem">

    @if (User.Identity.IsAuthenticated)
    {


        @if (Model.Count() != 0)
        {
            var orderId = Model.Select(x => x.OrderId).First();
            @foreach (var item in Model)
            {
                <div>
                    <img src="~/images/@item.Product.ImageFileName" />
                    <span>@item.Product.Name</span>
                    <span>@item.User.UserName</span>
                    <span>@item.Order.Id</span>
                </div>
            }

            <button onclick="PayForOrder('@orderId', '@sessionId')">Dokonaj zakupu</button>
        }
        else
        {
            <h2>Brak pozycji do wyswietlenia</h2>
        }
    }
    else
    {
        <h2>Zaloguj się aby skorzystac z funkcji koszyka</h2>
        <p id="test"></p>
    }
</div>

@section scripts
    {
    <script type="text/javascript">
        const p = document.getElementById("test");
        function PayForOrder(orderId, sessionId) {

            if (!confirm("Test"))
                return;
            $.ajax({
                type: "post",
                url: "@Url.Action("OrderPayment", "Shop")",
                data: {
                    orderId: orderId,
                    userId: sessionId
                },
                success: function(data) {
                    if (data.success) {

                        const a = document.createElement("a")
                        p.innerText = "TEST";
                        p.appendChild(a)

                    } else {
                        alert("zjebalo sie");
                    }
                },
                dataType: "json"
            });

        }

    </script>
}
